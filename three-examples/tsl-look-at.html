<!doctype html>
<html lang="es">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="/favicon.png" />
		<meta name="color-scheme" content="dark" />		
		<!-- Color for browser url bar in mobile/Safari -->
		<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#222222" />
		<!-- Disable Google FLOC -->
		<meta http-equiv="Permissions-Policy" content="interest-cohort=()" />
		<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1.0" />
		<meta property="og:type" content="website" />


		<script>
			// Calling this here so that it loads as quickly as possible
			// Avoiding a flash of light mode in case dark mode is used
			const theme = localStorage.getItem('theme-preference') || 'auto';
			document.firstElementChild?.setAttribute('data-theme', theme);
		</script>
		
		<link href="../_app/immutable/assets/7.DNbpoKaM.css" rel="stylesheet">
		<link href="../_app/immutable/assets/atom-one-dark.pERYd9e1.css" rel="stylesheet">
		<link href="../_app/immutable/assets/CristalPanel.xYD1iTQ7.css" rel="stylesheet">
		<link href="../_app/immutable/assets/Code.CKCio-tz.css" rel="stylesheet">
		<link rel="modulepreload" href="../_app/immutable/entry/start.Dys29Zju.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/wfScolaD.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/k_-SACZf.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BduZyM7k.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DIeogL5L.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CUZXlhwM.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/B6loGvSK.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CIWVgPg3.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/D15U5vI1.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/D4COoUHs.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Bkwfa0mc.js">
		<link rel="modulepreload" href="../_app/immutable/entry/app.DZhwLGq6.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Dp1pzeXC.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CWj6FrbW.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BqxltznQ.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/kPmmzQJp.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DzBwx_jc.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Km-0Pu8Z.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Cpacy8W0.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/0.CgfhGROC.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BTGqeDDF.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CqkleIqs.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/C-pAAiiO.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BQ15y-oL.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CgVzVCqa.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/7.IphvYap3.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/BSOZMg1Q.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/bJGP4r0Y.js">
		<link rel="modulepreload" href="../_app/immutable/nodes/22.BMFlspWS.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/CJDWlBBp.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/Wkx9sMwb.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/B3A7t7Jc.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/RmmjoSf4.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/NVWwRTYa.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DlsCqhfG.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/69_IOA4Y.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/DIabmNBn.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/611aVr9j.js">
		<link rel="modulepreload" href="../_app/immutable/chunks/rBwrARmC.js">
	</head>
	<body data-sveltekit-preload-data="hover" class="loading">
		<div class="hydration-protection-wrapper__dont-remove" 
			 style="display: contents"><!--[--><!--[--><!----><!--[--><!----><!--[!--><!----><canvas></canvas> <header class="example-header"><div class="cristal-pane svelte-1o6kcy3"><!--[!--><!--]--> <h2 class="example-title">Vertex position modification with TSL | Look at | Billboard case</h2><!----></div><!----></header> <main class="example-info"><div class="cristal-pane svelte-1o6kcy3"><!--[--><header class="svelte-1o6kcy3"><h3><!---->What is shown here<!----></h3></header><!--]--> <p>In this scene, we have a ðŸŸ¨ cube (a 3D equirectangular shape with eight vertices) that is always facing <small>(z-facing)</small> the camera â€” a billboard effect performed on the GPU.
  It still retains its own rotation information in its transform matrix, but this is ignored.
  Since we only see one face of the cube, it appears as a flat square that always faces us â€”
  but pay attention to its shadow on the floor.</p> <p><input type="checkbox" id="offset-checkbox"/> <label for="offset-checkbox">Or check this to add a slight offset to the lookAt target</label></p> <p>This is just an example that allows you to use any material while preserving geometry and lighting
                if compatible, with a lookAt to any position. For a more specific billboard effect, you might
                want to use a specific material for it in order to achieve better performance.</p><!----></div><!----> <div class="cristal-pane svelte-1o6kcy3"><!--[--><header class="svelte-1o6kcy3"><h3><!---->Material creation<!----></h3></header><!--]--> <p>You can use any <code>NodeMaterial</code>. Just make sure to set its <code>positionNode</code> property
  using the function below. If youâ€™re using a material that reacts to lighting,
  be sure to also transform the normals by setting the <code>normalNode</code> property.</p> <div class="code-wrapper svelte-122pskk" style="--lang-color: #3178c6"><!--[--><div class="code-wrapper__lang svelte-122pskk">TypeScript</div><!--]--> <div class="code-wrapper__buttons svelte-122pskk"><!--[!--><!--]--> <!--[!--><!--]--></div> <pre class="svelte-122pskk"><code class="language-typescript svelte-122pskk"><!----><!---->export const lookAtTargetUniform = uniform(new Vector3())
const worldUp = vec3(0.0, 1.0, 0.0).toVar()
const look = normalize(lookAtTargetUniform.sub(modelPosition)).toVar()
const right = normalize(cross(worldUp, look)).toVar()
const upOrtho = cross(look, right).toVar()

export const lookAtPositionFn = Fn(() => {
    const offsetWorld = right
        .mul(positionLocal.x)
        .add(upOrtho.mul(positionLocal.y))
        // Comment this line to collapse geometry to the plane
        .add(look.mul(positionLocal.z))

    const newWorldPos = modelPosition.add(offsetWorld)
    return modelWorldMatrixInverse.mul(newWorldPos) // World -> Local
})<!----></code></pre></div><!----><!----></div><!----> <div class="cristal-pane svelte-1o6kcy3"><!--[--><header class="svelte-1o6kcy3"><h3><!---->Usage<!----></h3></header><!--]--> <div class="code-wrapper svelte-122pskk" style="--lang-color: #3178c6"><!--[--><div class="code-wrapper__lang svelte-122pskk">TypeScript</div><!--]--> <div class="code-wrapper__buttons svelte-122pskk"><!--[!--><!--]--> <!--[!--><!--]--></div> <pre class="svelte-122pskk"><code class="language-typescript svelte-122pskk"><!----><!---->    const material = new MeshStandardNodeMaterial() // or any NodeMaterial

    material.positionNode = lookAtPositionFn()
    material.normalNode = normalLocal
    
    // ...
    // Remember to update lookAtTargetUniform if the target position changes. 
    // In this case the camera position changes every frame,
    // so we do it in the render loop:
    camera.getWorldPosition(lookAtTargetUniform.value)<!----></code></pre></div><!----></div><!----> <div class="cristal-pane svelte-1o6kcy3"><!--[--><header class="svelte-1o6kcy3"><h3><!---->F.A.Q<!----></h3></header><!--]--> <dl class="faq-list"><dt>Q: Can I use the TSL exposed <code>cameraPosition</code> instead a custom uniform if the target is the camera?</dt> <dd>A: When shadows are enabled, <code>cameraPosition</code> represents the position of the light's
  shadow camera during the shadow-mapping pass, rather than the main render camera.
  This causes the geometry to face the light instead of the viewer, resulting in incorrect shadows.
  As far as I know, you should avoid using <code>cameraPosition</code> in this case.</dd> <dt>Q: Why perform <code>lookAt</code> on the GPU? We already have <code>lookAt</code> on the CPU, and its transform matrix is used by the GPU anyway.</dt> <dd>A: Who knows? Think about extreme cases â€” like a CPU state based particle system. Iterating over a million object matrices on the CPU to perform a <code>lookAt</code> 60 times per second doesn't sound so good.</dd> <dt>Q: Can I use this with <code>InstancedMesh</code>?</dt> <dd>A: Yes, but it requires some tweaks. Currently, the look vector uses the <code>modelPosition</code> instead of the per-instance position.
            I'm not sure if TSL exposes the instance base position directly. If not, you can pass it as a custom attribute.</dd></dl><!----></div><!----></main><!----><!--]--><!----> <header class="svelte-1c386zv"><h1>Three.js examples <address class="author svelte-1c386zv">by Alex Vega</address></h1></header> <button class="nav-button svelte-1c386zv"><!--[!-->&lt; ... ><!--]--></button><!----><!--]--><!----><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_hm0bcj = {
						base: new URL("..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("../_app/immutable/entry/start.Dys29Zju.js"),
						import("../_app/immutable/entry/app.DZhwLGq6.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 7, 22],
							data: [null,null,null],
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
